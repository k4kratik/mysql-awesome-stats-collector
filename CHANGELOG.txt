MySQL Awesome Stats Collector (MASC) - Changes Made
====================================================

1. INITIAL SETUP
   â€¢ Built FastAPI web application for MySQL diagnostics
   â€¢ Created hosts.yaml for host configuration
   â€¢ Set up SQLite for job metadata storage
   â€¢ Implemented background job collection system
   â€¢ Created Jinja2 templates with TailwindCSS styling

2. UV PACKAGE MANAGER
   â€¢ Switched from pip/requirements.txt to uv for package management
   â€¢ Created pyproject.toml for dependency management

3. HOSTS CONFIGURATION
   â€¢ Updated hosts.yaml with RDS instances (Primary, Replica-3, Replica-4)

4. HOMEPAGE CHECKBOX FIX
   â€¢ Fixed radio select (checkboxes) not working on homepage
   â€¢ Changed @click logic to x-model="selectedHosts" for proper Alpine.js state syncing

5. MYSQL CLI \G ERROR FIX
   â€¢ Fixed "Unknown command '\G'" error
   â€¢ Switched from \G format to tabular output
   â€¢ Updated parsers to handle tabular format
   â€¢ Used MYSQL_PWD environment variable for password security

6. PROCESSLIST SORTING
   â€¢ Added client-side sorting using Alpine.js
   â€¢ Click column headers to sort ascending/descending
   â€¢ Supports sorting by ID, User, Host, DB, Command, Time, State

7. PROCESSLIST COLUMN DISPLAY FIX
   â€¢ Fixed processlist not showing due to JSON parsing issues in x-data
   â€¢ Moved processlist JSON to <script> tag (window.processlistData)

8. GLOBAL STATUS DISPLAY IMPROVEMENTS
   â€¢ Fixed long values (like RSA public keys) extending column width
   â€¢ Added value truncation (>50 chars) with "Expand" button
   â€¢ Added search functionality for variables
   â€¢ Implemented number formatting (K, M, B for large numbers)
   â€¢ InnoDB Row Operations: millions/billions/thousands formatting
   â€¢ Network Bytes: GB formatting

9. TIMESTAMPS IN LOGS
   â€¢ Added timestamps to raw output header and footer
   â€¢ Added timestamps before each MySQL command
   â€¢ Added started_at/completed_at to job detail page
   â€¢ Added duration display for completed hosts

10. SERVER LOGS ENHANCEMENT
    â€¢ Added timestamps to server logs
    â€¢ Added host details (label, host:port) to logs
    â€¢ Added DB connection logging with PID
    â€¢ Logs show: [DB CONNECT] PID xxx - Connected to host
    â€¢ Logs show: [DB DISCONNECT] PID xxx - Closed successfully/with error

11. DATABASE CLEANUP
    â€¢ Added instructions for cleaning observer.db
    â€¢ Created .gitignore to exclude:
      - observer.db
      - runs/
      - __pycache__/
      - .venv/
      - *.egg-info/
      - uv.lock
      - .env
      - *.py[cod]
    â€¢ Cleaned up existing .pyc files

12. GLOBAL STATUS JSON FIX
    â€¢ Fixed x-data JSON breaking after Network Bytes section
    â€¢ Moved global_status JSON to <script> tag (window.globalStatusData)

13. COPY TO CLIPBOARD
    â€¢ Added "Copy to Clipboard" button to Raw Output tab
    â€¢ Added "Copy to Clipboard" button to InnoDB tab
    â€¢ Shows green checkmark and "Copied!" message for 2 seconds
    â€¢ Fallback support for older browsers

14. INNODB STATUS STRUCTURED DISPLAY
    â€¢ Created parse_innodb_status_structured() function
    â€¢ Fixed literal \n parsing from MySQL tabular output
    â€¢ Added visual dashboard with key metrics:
      - Buffer Pool Hit Rate, Utilization, Dirty Pages
      - History List Length, Active Transactions
      - Queries in InnoDB
    â€¢ Added Row Operations section (inserts/updates/deletes/reads per sec)
    â€¢ Added Buffer Pool & Memory section with utilization bar
    â€¢ Added Redo Log section
    â€¢ Added File I/O section
    â€¢ Added Insert Buffer & Adaptive Hash Index section
    â€¢ Added Transactions section
    â€¢ Added Background Thread section
    â€¢ Toggle between Parsed view and Raw view

15. CONFIG VARIABLES TAB (4TH TAB)
    â€¢ Added SHOW GLOBAL VARIABLES to MySQL commands
    â€¢ Created parse_config_variables() function
    â€¢ Stores config to config_vars.json
    â€¢ Shows 22 important variables (allowlist)
    â€¢ Human-readable formatting:
      - Byte sizes â†’ GB/MB/KB with raw value
      - Numbers â†’ comma-formatted
      - ON/OFF â†’ colored badges

16. CONFIG VARIABLES TOGGLE (SHOW ALL)
    â€¢ Added toggle to switch between Important (22) and All (~600) variables
    â€¢ Search box when viewing all variables
    â€¢ Important variables marked with â˜… star
    â€¢ Scrollable table (max 600px height) with sticky header

17. CONFIG HEALTH INDICATORS
    â€¢ Added health indicators (ðŸŸ¢ðŸŸ¡ðŸ”´) to Important Config section
    â€¢ Health column with tooltips showing reason
    â€¢ Variables with health checks:
      - innodb_buffer_pool_size (vs RAM %)
      - max_connections (usage %)
      - tmp_table_size (â‰¥64MB healthy)
      - max_heap_table_size (vs tmp_table_size)
      - table_open_cache (vs Open_tables)
      - table_definition_cache (vs Open_table_definitions)
      - open_files_limit (â‰¥2Ã— table_open_cache)
      - thread_cache_size (>0 healthy)
      - wait_timeout (â‰¥300s healthy)
      - innodb_log_file_size (â‰¥512MB healthy)
      - innodb_flush_log_at_trx_commit (1=healthy, 2=warning, 0=critical)
      - sync_binlog (1=healthy, 0=warning)
      - innodb_read_io_threads (â‰¥4 healthy)
      - innodb_write_io_threads (â‰¥4 healthy)

18. ADDITIONAL CONFIG VARIABLES
    â€¢ Added 8 new variables to Important Config (total: 30):
      - innodb_read_io_threads
      - innodb_write_io_threads
      - innodb_sync_array_size
      - innodb_change_buffering
      - binlog_group_commit_sync_delay
      - slave_parallel_workers
      - slave_preserve_commit_order
      - max_prepared_stmt_count

19. PROCESSLIST QUERY FILTER
    â€¢ Added query filter to Processlist tab
    â€¢ Filters by Info column content (SQL query)
    â€¢ Case-insensitive substring matching
    â€¢ Useful for filtering by: SELECT, UPDATE, table names, etc.

20. PARALLEL COMMAND EXECUTION
    â€¢ MySQL commands now run in PARALLEL (4 concurrent connections)
    â€¢ Uses ThreadPoolExecutor for concurrent execution
    â€¢ Significantly faster collection (~4x speedup)
    â€¢ Example: 4 commands Ã— 2s each = 2s total (vs 8s sequential)

21. TIMING METRICS IN UI
    â€¢ Added timing.json with per-command metrics
    â€¢ Shows total collection time with âš¡ indicator
    â€¢ Expandable "Command Timing" dropdown showing:
      - Per-command duration
      - Success/failure status (âœ“/âœ—)
    â€¢ Helps identify slow commands or network issues

22. JOB NAMING
    â€¢ Added optional "Job Name" input field on homepage
    â€¢ Job name displayed in jobs list and job detail pages
    â€¢ Falls back to job ID if no name provided
    â€¢ Helps organize collection runs (e.g., "Load test baseline")
    â€¢ Added `name` column to Job model in SQLite

23. INSTANT TOOLTIPS FOR CONFIG HEALTH
    â€¢ Replaced browser default tooltip (slow ~500ms delay)
    â€¢ Custom Alpine.js tooltip shows instantly on hover
    â€¢ Styled with dark theme matching the app

24. JOB COMPARISON FEATURE
    â€¢ New /compare page to select two completed jobs
    â€¢ Compares only hosts that exist in both jobs
    â€¢ Global Status: numeric diff with delta (increase=red, decrease=green)
      - Metrics: Threads_running, Slow_queries, Select_scan, etc.
    â€¢ Processlist: summary comparison (total, long_running, users)
    â€¢ Config Variables: side-by-side with changed values highlighted
    â€¢ InnoDB Status: unified text diff with +/- lines
    â€¢ Added "Compare" link to main navigation
    â€¢ No database storage - loads directly from filesystem

25. UI IMPROVEMENTS
    â€¢ Instant tooltips for hostname hover (homepage, job detail)
    â€¢ MySQL database favicon
    â€¢ "Commands to Execute" updated with all 4 commands + descriptions
    â€¢ Command timing shows actual names (InnoDB Status, Global Status, etc.)
    â€¢ Job Name label shows "(optional)" inline
    â€¢ Host detail tabs reordered: InnoDB first, Raw Output last

26. REGRESSION DETECTION HEURISTICS
    â€¢ Added automatic regression detection when comparing jobs
    â€¢ 8 deterministic rules implemented:
      - Thread pressure (Threads_running > 50% increase + > CPU cores)
      - Slow query rate increase
      - Temp table disk spill ratio increase
      - Row lock contention (waits + avg time)
      - Buffer pool efficiency drop (> 1%)
      - Table cache overflow/miss increase
      - Redo log contention (Innodb_log_waits)
      - Long-running queries increase (Time > 10s)
    â€¢ Regression Summary section at top of comparison results
    â€¢ ðŸ”´ Critical (red) and ðŸŸ¡ Warning (yellow) severity levels
    â€¢ âœ… "No Regressions Detected" when metrics stable
    â€¢ Click "View Details" to jump to affected host tab
    â€¢ Pure function: detect_regressions() in compare.py

27. REGRESSION NOISE REDUCTION & ROOT-CAUSE HIERARCHY
    â€¢ Root-cause hierarchy: threads > locking > table_cache > buffer_pool > redo_log > temp_tables > processlist
    â€¢ Noise reduction rules:
      - Rule 1: Root cause suppression (thread_pressure suppresses processlist/temp_tables)
      - Rule 2: Low signal suppression (< 5% delta AND small absolute value)
      - Rule 3: Cold start suppression (uptime < 600s â†’ skip buffer_pool/table_cache)
      - Rule 4: Single event downgrade (1 event â†’ critical â†’ warning)
      - Rule 5: Cross-host correlation (all hosts affected â†’ downgrade severity)
    â€¢ Suppressed regressions preserved with reason
    â€¢ "Show suppressed issues" toggle in UI
    â€¢ Suppressed items shown in gray, smaller font, with explanation
    â€¢ Pure function: refine_regressions() in compare.py

28. HOSTS FILE OVERRIDE
    â€¢ Added MASC_HOSTS_FILE environment variable to override hosts.yaml path
    â€¢ Added MASC_RUNS_DIR environment variable to override runs directory
    â€¢ Startup log shows which hosts file is being used

29. PYPI PACKAGE PUBLISHING
    â€¢ Renamed project: MySQL Observer â†’ MySQL Awesome Stats Collector (MASC)
    â€¢ Package name: mysql-awesome-stats-collector
    â€¢ CLI commands: `masc` (short) and `mysql-awesome-stats-collector` (full)
    â€¢ Added CLI entry points with --host, --port, --reload, --hosts-file, --version
    â€¢ Created docs/PUBLISHING.md with PyPI upload instructions
    â€¢ Updated pyproject.toml with full PyPI metadata
    â€¢ Created MANIFEST.in for including templates
    â€¢ Package ready for: pip install mysql-awesome-stats-collector

